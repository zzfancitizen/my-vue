<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><title>Class ZTH_TRPA_INTEGRATION_TEST</title><link rel="stylesheet" href="../../../htmldesign/stylesheet.css" type="text/css"></head><body><div id="header"><div id="navigationMenu"><a href="#types">Types</a> | <a href="#constants">Constants</a> | <a href="#attributes">Attributes</a> | <a href="#methods">Methods</a></div></div><div id="content"><h2>Class <span class="identifier objectName">ZTH_TRPA_INTEGRATION_TEST</span></h2><p>public abstract create public for testing</p><h4>Documentation</h4><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">General super integration test class</p>
 <p>You can inherit this class to build a simple integration test.</p>
 <p>Start your test with me-&gt;test_configuration-&gt;set_tdc_variant( VARIANT_NAME )
 <p>All methods on me-&gt;assert_that are for checking a state in the system</p></span><h4 id="types">Types</h4><table><thead><tr><th>Visibility and Level</th><th>Name</th><th>Documentation</th></tr></thead><tr ><td>private</td><td><span class="identifier fieldName">t_to_be_reversed_transaction</span> (structured type)</td><td>&#160;</td></tr><tr ><td>private</td><td><span class="identifier fieldName">t_to_be_reversed_transactions</span> TYPE STANDARD TABLE OF t_to_be_reversed_transaction WITH NON-UNIQUE DEFAULT KEY</td><td>&#160;</td></tr></table><h4 id="constants">Constants</h4><table><thead><tr><th>Visibility and Level</th><th>Name</th><th>Documentation</th></tr></thead><tr ><td>protected static</td><td><span class="identifier fieldName">manual_valuation_without_reset</span> type TPM_VAL_CAT value&#x20;04</td><td>&#160;</td></tr><tr ><td>protected static</td><td><span class="identifier fieldName">manual_valuation_with_reset</span> type TPM_VAL_CAT value&#x20;05</td><td>&#160;</td></tr><tr ><td>protected static</td><td><span class="identifier fieldName">mid_year_valuation_with_reset</span> type TPM_VAL_CAT value&#x20;02</td><td>&#160;</td></tr><tr ><td>protected static</td><td><span class="identifier fieldName">mid_year_valu_without_reset</span> type TPM_VAL_CAT value&#x20;03</td><td>&#160;</td></tr><tr ><td>protected static</td><td><span class="identifier fieldName">year_end_valuation</span> type TPM_VAL_CAT value&#x20;01</td><td>&#160;</td></tr></table><h4 id="attributes">Attributes</h4><table><thead><tr><th>Visibility and Level</th><th>Name</th><th>Documentation</th></tr></thead><tr ><td>protected instance</td><td><span class="identifier fieldName">assert_that</span> type ref to ZIF_TRPA_ASSERT_THAT  </td><td>&#160;</td></tr><tr ><td>protected instance</td><td><span class="identifier fieldName">test_configuration</span> type ref to ZTH_TRPA_TEST_CONFIGURATION  </td><td>&#160;</td></tr><tr ><td>protected instance</td><td><span class="identifier fieldName">transaction_service</span> type ref to ZTH_TRPA_TRANSACTION_SERVICES  </td><td>&#160;</td></tr><tr ><td>private instance</td><td><span class="identifier fieldName">current_position</span> type ref to ZIF_TRPA_TEST_POSITION  </td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Treasury position the test is working on</p>
 All actions that are executed on a position will be done on this position, if not
 specified otherwise trough parameters.</span></td></tr><tr ><td>private instance</td><td><span class="identifier fieldName">current_transaction</span> type ref to ZIF_TRPA_TEST_TRANSACTION  </td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Last business transaction</p>
 Last transaction created by the test.<br/>
 Includes:
 <ul>
  <li>Purchased or sold securities</li>
  <li>Purchased or sold swaps</li>
  <li>Loans</li>
 </ul></span></td></tr></table><h4 id="methods">Methods</h4><table><thead><tr><th>Visibility and Level</th><th>Name</th><th>Documentation</th></tr></thead><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">bw_extractor_index_clean</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_key_date_from</span></td><td>type D</td></tr><tr><td></td><td><span class="identifier parameterName">i_key_date_to</span></td><td>type D</td></tr><tr><td>exporting</td><td><span class="identifier parameterName">e_bw_delta_records</span></td><td>type FTI_BIW_CFM_DELTA_POSITION_T</td></tr></table></td><td>&#160;</td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">cleanup_position</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_position_diff_values</span></td><td>type ZIF_TRPA_TEST_TRANSACTION=>T_POSITION_DIFF_VALUES</td></tr><tr><td></td><td><span class="identifier parameterName">i_valuation_areas</span></td><td>type TRGY_VAL_AREA optional</td></tr></table></td><td>&#160;</td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">purchase_loan</span> </td></tr><tr><td>returning</td><td>value(<span class="identifier parameterName">r_transaction</span>)</td><td>type ref to ZIF_TRPA_TEST_TRANSACTION</td></tr></table></td><td><h5>Parameters</h5><table class="methodParametersDocumentation"><tr ><td><span class="identifier parameterName">r_transaction</span></td><td><span title="Short Text">Represents&#x20;a&#x20;Transaction&#x20;in&#x20;Integration&#x20;Test</span></td></tr></table></td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">purchase_security</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_initial_classifier</span></td><td>type TRPA_CLASSIFIER_VALUE optional</td></tr><tr><td></td><td><span class="identifier parameterName">i_position_date</span></td><td>type TPM_POSITION_DATE optional</td></tr><tr><td></td><td><span class="identifier parameterName">i_number_units</span></td><td>type TB_ASTUECK optional</td></tr><tr><td></td><td><span class="identifier parameterName">i_price</span></td><td>type BAPITM_BUPRC optional</td></tr><tr><td></td><td><span class="identifier parameterName">i_nominal_amount</span></td><td>type TPM_NOMINAL_AMT optional</td></tr><tr><td></td><td><span class="identifier parameterName">i_payment_amount</span></td><td>type TPM_PAYMENT_AMT optional</td></tr><tr><td></td><td><span class="identifier parameterName">i_general_valuation_class</span></td><td>type TPM_COM_VAL_CLASS optional</td></tr><tr><td>returning</td><td>value(<span class="identifier parameterName">r_transaction</span>)</td><td>type ref to ZIF_TRPA_TEST_TRANSACTION</td></tr></table></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Purchases a security</p>
 <p>If not overwritten by the optional parameters, all values for creation
 will come from the test configuration.</p>
 <em>Requires:</em><br/>
 <ul>
 <li>me-&gt;test_configuration must be bound</li>
 </ul>
 <em>Guarantees:</em>
 <ul>
 <li>r_transaction is bound</li>
 <li>me-&gt;current_transaction is bound</li>
 <li>me-&gt;current_transaction = r_transaction</li>
 </ul>
 </span><h5>Parameters</h5><table class="methodParametersDocumentation"><tr ><td><span class="identifier parameterName">i_initial_classifier</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Initial Stage</p>
 </span></td></tr><tr ><td><span class="identifier parameterName">i_position_date</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Position Date</p>
 </span></td></tr><tr ><td><span class="identifier parameterName">i_number_units</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Number of Units</p>
 </span></td></tr><tr ><td><span class="identifier parameterName">i_price</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Security price</p>
 </span></td></tr><tr ><td><span class="identifier parameterName">i_nominal_amount</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Nominal amount</p>
 </span></td></tr><tr ><td><span class="identifier parameterName">i_payment_amount</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Payment amount</p>
 </span></td></tr><tr ><td><span class="identifier parameterName">i_general_valuation_class</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">General Valuation Class</p>
 </span></td></tr><tr ><td><span class="identifier parameterName">r_transaction</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Transaction representing the purchase</p></span></td></tr></table></td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">purchase_swap</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_initial_classifier</span></td><td>type TRPA_CLASSIFIER_VALUE optional</td></tr><tr><td>returning</td><td>value(<span class="identifier parameterName">r_transaction</span>)</td><td>type ref to ZIF_TRPA_TEST_TRANSACTION</td></tr></table></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Purchases a SWAP transaction</p>
 <p>If not overwritten by the optional parameters, all values for creation
 will come from the test configuration.</p>
 <em>Requires:</em><br/>
 <ul>
 <li>me-&gt;test_configuration must be bound</li>
 </ul>
 <em>Guarantees:</em>
 <ul>
 <li>r_transaction is bound</li>
 <li>me-&gt;current_transaction is bound</li>
 <li>me-&gt;current_transaction = r_transaction</li>
 </ul>
 </span><h5>Parameters</h5><table class="methodParametersDocumentation"><tr ><td><span class="identifier parameterName">i_initial_classifier</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Initial stage</p>
 </span></td></tr><tr ><td><span class="identifier parameterName">r_transaction</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Transaction representing the purchase</p></span></td></tr></table></td></tr><tr ><td>protected instance</td><td><span class="identifier methodName">reverse_previous_runs</span> </td><td>&#160;</td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">rev_stage_trans_and_valuations</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_position_diff_values</span></td><td>type ZIF_TRPA_TEST_TRANSACTION=>T_POSITION_DIFF_VALUES</td></tr><tr><td></td><td><span class="identifier parameterName">i_valuation_areas</span></td><td>type TRGY_VAL_AREA optional</td></tr></table></td><td>&#160;</td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">sell_security</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_position_date</span></td><td>type D</td></tr><tr><td>returning</td><td>value(<span class="identifier parameterName">r_transaction</span>)</td><td>type ref to ZIF_TRPA_TEST_TRANSACTION</td></tr></table></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Sells a security</p>
 <em>Requires:</em><br/>
 <ul>
 <li>me-&gt;test_configuration must be bound</li>
 </ul>
 <em>Guarantees:</em>
 <ul>
 <li>r_transaction is bound</li>
 <li>me-&gt;current_transaction is bound</li>
 <li>me-&gt;current_transaction = r_transaction</li>
 </ul>
 </span><h5>Parameters</h5><table class="methodParametersDocumentation"><tr ><td><span class="identifier parameterName">i_position_date</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Position Date</p>
 </span></td></tr><tr ><td><span class="identifier parameterName">r_transaction</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Transaction representing the sell</p></span></td></tr></table></td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">settle</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_transaction</span></td><td>type ref to ZIF_TRPA_TEST_TRANSACTION</td></tr></table></td><td>&#160;</td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">switch_to_tpm15m_target_pos</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_key_date</span></td><td>type D</td></tr><tr><td></td><td><span class="identifier parameterName">i_valuation_class</span></td><td>type TPM_VAL_CLASS</td></tr></table></td><td>&#160;</td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">tbb1</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_key_date</span></td><td>type D</td></tr></table></td><td>&#160;</td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">tpm1</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_valuation_category</span></td><td>type TPM_VAL_CAT</td></tr><tr><td></td><td><span class="identifier parameterName">i_key_date</span></td><td>type D</td></tr></table></td><td>&#160;</td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">tpm15m</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_valuation_class</span></td><td>type TPM_VAL_CLASS</td></tr><tr><td></td><td><span class="identifier parameterName">i_key_date</span></td><td>type D</td></tr></table></td><td>&#160;</td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">trpa_la_val</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_key_date</span></td><td>type D</td></tr><tr><td></td><td><span class="identifier parameterName">i_reset</span></td><td>type SAP_BOOL default ABAP_FALSE</td></tr></table></td><td>&#160;</td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">trpa_la_val_rev</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_key_date</span></td><td>type D</td></tr></table></td><td>&#160;</td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">trpa_transfer</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_key_date</span></td><td>type D</td></tr><tr><td></td><td><span class="identifier parameterName">i_new_stage</span></td><td>type TRPA_CLASSIFIER_VALUE</td></tr><tr><td></td><td><span class="identifier parameterName">i_stage_trans_select_mode</span></td><td>type TRPA_STAGE_TRANS_SELECT_MODE default IF_TRPA_CONSTANTS&#x3d;&gt;CV_STAGE_TRANS_SELECT_NEW</td></tr></table></td><td><h5>Parameters</h5><table class="methodParametersDocumentation"><tr ><td><span class="identifier parameterName">i_stage_trans_select_mode</span></td><td><span title="Short Text">Selection&#x20;Mode&#x20;for&#x20;the&#x20;Stage&#x20;Transfer&#x20;Transaction</span></td></tr></table></td></tr><tr ><td>protected instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">trpa_transfer_rev</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_key_date</span></td><td>type D</td></tr></table></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Reverses a stage transfer on the given date</p>
 For the current position, the stage transfer will be reversed
 <em>Requires:</em>
 <ul>
 <li>i_key_date must not be initial</li>
 <li>me-&gt;current_position must be bound</li>
 </ul>
 <em>Guarantees:</em>
 <ul>
 <li>Nothing</li>
 </ul>
 </span><h5>Parameters</h5><table class="methodParametersDocumentation"><tr ><td><span class="identifier parameterName">i_key_date</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Transfer date</p></span></td></tr></table></td></tr><tr ><td>private instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">get_to_be_reversed_trans</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_business_transactions</span></td><td>type TRLY_TRANSACTION</td></tr><tr><td>returning</td><td>value(<span class="identifier parameterName">r_to_be_revrsed_transactions</span>)</td><td>type T_TO_BE_REVERSED_TRANSACTIONS</td></tr></table></td><td>&#160;</td></tr><tr ><td>private instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">reverse_transactions</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_to_be_revrsed_transactions</span></td><td>type T_TO_BE_REVERSED_TRANSACTIONS</td></tr><tr><td></td><td><span class="identifier parameterName">i_security_position</span></td><td>type ZIF_TRPA_TEST_TRANSACTION=>T_POSITION_DIFF_VALUES</td></tr></table></td><td>&#160;</td></tr><tr ><td>private instance</td><td><span class="identifier methodName">setup</span> </td><td>&#160;</td></tr><tr ><td>private instance</td><td><table class="methodSignature"><tr><td colspan="3"><span class="identifier methodName">set_current_transaction</span> </td></tr><tr><td>importing</td><td><span class="identifier parameterName">i_transaction</span></td><td>type ref to ZIF_TRPA_TEST_TRANSACTION</td></tr></table></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Sets the current transaction for future use</p>
 <p>Sets the current transaction for further use. All further actions will
 be done for the given transaction or for the related position</p>
 <em>Requires:</em><br/>
 <ul>
 <li>i_transaction must be bound</li>
 </ul>
 <em>Guarantees:</em><br/>
 <ul>
 <li>me-&gt;current_transaction = i_transaction</li>
 <li>me-&gt;current_position is bound</li>
 </ul>
 </span><h5>Parameters</h5><table class="methodParametersDocumentation"><tr ><td><span class="identifier parameterName">i_transaction</span></td><td><span class="abapDocComment"> <p class="shorttext synchronized" lang="en">Transaction to set</p></span></td></tr></table></td></tr></table></div><div id="footer">Generated on 07.02.2019</div></body></html>